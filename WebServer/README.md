# Resery's WebServer 技术文档

## 读取请求与发送响应


## HTTP 状态机解析请求

1. 概述
   此 WebServer 使用主从状态机模式来进行解析，主状态机调用从状态机来读取数据，从状态机根据读取到到数据更新自身的状态，主状态机根据从状态机返回的状态来决定是继续读取数据还是响应请求
2. 主状态机
   主状态机应有 3 种状态，当前正在解析请求行，请求头和请求体
   最开始 HTTPHandler 对象的主状态会被设置为**正在解析请求行状态**，在主状态机内根据主状态判断当前应执行何种动作，也就是首先解析请求行，解析完请求行之后，直接检测是否能支持此次请求以及此次请求是否属于合法状态，因为请求行已经解析完成了所以说应该更新主状态机的状态，解析完请求行就应该解析请求头了，我实现的 WebServer 主要解析是否是长连接以及请求主体的长度，此时对象的主状态为**正在解析请求头状态**，解析完请求头之后，就立即将对象的状态设置为**正在解析请求主体状态**

   在每次状态转换期间，都会根据每次解析之后的结果来进行不同的操作，比如说从**解析请求行状态**转移到**解析请求头状态**期间发现不支持当前的请求方法那么就会直接返回一个错误报文，并且结束此次的连接，再或者说从解析请求行之后发现此次请求不包含报文主体那么就不会进行**解析请求头状态**到**解析请求主体状态**的转移
3. 从状态机
   从状态机应有 3 种状态，读取到完整到一行，没有读完一行和读取发生错误
   从状态机主要是起一个辅助的作用，从状态机并不解析请求报文中的内容仅检测数据是否完整，然后按行读取请求报文，当数据完整且正常时从状态机会返回 LineOk 状态，当数据不完整但正常时从状态机会返回 LineOpen 状态，当数据不正常时从状态机会返回 LineBad 状态，只有当从状态机的状态为 LineOk 状态时主状态机才可以继续工作，如果从状态机的状态为 LineOpen 状态或者 LineBad状态时那么主状态机也会随之终止
4. 为什么使用状态机
   使用状态机主要是可以让开发者的思路变的更为清晰，逻辑更通顺，以及来提升开发的效率，以上为个人见解

## 线程池


